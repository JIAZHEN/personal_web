FROM nginx:mainline

ENV RAILS_ROOT /var/www/application

RUN apt-get update -yqq && apt-get -y install apache2-utils
RUN apt-get install -y cron certbot python-certbot-nginx bash wget

WORKDIR $RAILS_ROOT

RUN mkdir log
COPY public public/
COPY nginx.conf /tmp/docker.nginx
RUN envsubst '$RAILS_ROOT' < /tmp/docker.nginx > /etc/nginx/conf.d/default.conf

# RUN certbot certonly --standalone --agree-tos -m "${DOMAIN_EMAIL}" -n -d ${DOMAIN_LIST}
RUN rm -rf /var/lib/apt/lists

EXPOSE 80

CMD [ "nginx", "-g", "daemon off;" ]
